<!DOCTYPE html>
<html>
    <head>
        <title>importing test</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src='../google/tensorflow2.7.0.min.js'></script>
        <script src='../TFLayerPath.js'></script>
        <script src='../GuzuTFPlugins.js'></script>
        <script src="../GuzuDataTools.js"></script>
        <script src="../layerFixedConv2d.js"></script>
        <script>

        var s=[]; for(j=0;j<2;j++)for(var i=0;i<6;i++)
        s=s.concat([s.length>4&&j==1?1:0, s.length>4?1:0, s.length>1?.5:0,  s.length>1?1:0,0,0])
        //console.log(s.length)
        var a=tf.tensor3d(s,[2,6,6]).step();a.print();

        var p=tf.util.path();
        p.add("in",tf.input({shape:[6,6,3]}));
        p.to("count",tf.layers.bbox());

        var m=tf.model({inputs:[p.get("in")],outputs:[p.apply()]});
        var c,cx;
        function onload(){
            c=document.getElementById("c");//new OffscreenCanvas(256, 256);
            cx=c.getContext('2d');
            cx.textAlign="center";
            cx.textBaseline="middle";
        }

        var fonts=[
            "sans-serif",//
            "Monospace",//
            "Arial",
            "Times New Roman",
            "Helvetica",
            "Courier New",
            "Verdana",
            "Arial Narrow",
            "Candara",
            "Calibri",
            "Cambria",
            "Impact",
            "Georgia",
            "Trebuchet MS",
            "Comic Sans MS"
        ];
        function draw(text,fontNumber,sizeoffset=0,xoffset=0,yoffset=0,rotate){
            cx.font=(sizeoffset+20)+"px "+fonts[fontNumber||0];
            
            cx.clearRect(0,0,48,48);
            
            cx.translate(24+xoffset,24+yoffset);
            cx.rotate(rotate*Math.PI/180);
            cx.fillText(text,0,0);
            cx.resetTransform();
        }

        function drawRandom(){
            var r;
            draw(r=Math.floor(Math.random()*10),Math.floor(Math.random()*fonts.length),Math.random()*4-8,Math.random()*8-16,Math.random()*5-10,-20+Math.random()*40)
            return r;
        }

        var t1;
        //idea to convert imagedata to tensor
        function test(){
            var a=cx.getImageData(0,0,48,48).data;
            t1=tf.tensor(Array.from(a),[48,48,4]);
            t1=tf.guzu.removeChannels(t1,[0,1,2]);
            t1.max().print();
        }

        function makeDataset(size=32){
            return tf.tidy(()=>{
                var inputs=[],outputs=[],a;
                for(var i=0;i<size;i++){
                    outputs.push(drawRandom());
                    a=cx.getImageData(0,0,48,48).data;
                    inputs.push(Array.from(a));
                }
                inputs=tf.tensor(inputs,[size,48,48,4]);
                outputs=tf.tensor(outputs,[size,1]);
                inputs=tf.guzu.removeChannels(inputs,[0,1,2]);
                return [inputs,outputs];
            });
        }

        </script>
    <body onload="onload()">
        <canvas id="c" width=48 height=48></canvas>
    </body>
</html>